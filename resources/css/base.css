/* ========== RESET STYLES ========== */
* {
    /* Remove default margins from all elements */
    margin: 0;
    /* Remove default padding from all elements */
    padding: 0;
    /* Include padding and border in element's total width and height */
    box-sizing: border-box;
}

/* ========== BODY STYLES ========== */
body {
    /* Create a diagonal gradient background from dark blue to slightly lighter blue */
    background: linear-gradient(135deg, #1e2030 0%, #2f354d 100%);
    /* Set text color to white */
    color: #ffffff;
    /* Make body at least full viewport height */
    /* Make body at least full viewport height, using dvh for mobile browsers */
    min-height: 100vh;
    min-height: 100dvh;
    margin: 0;
    padding: 0;
    /* Use flexbox for vertical layout */
    display: flex;
    flex-direction: column;
    /* System font stack for optimal performance and fallbacks */
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    /* Prevent scrollbars from appearing */
    overflow: hidden;
    /* Prevent overscroll bounce on Android Chrome */
    overscroll-behavior: contain;
}

/* ========== PWA FULLSCREEN MODE ========== */
/* Safe area insets for Android fullscreen mode (no status bar, no nav bar) */
@media (display-mode: fullscreen) {
    body {
        /* Add padding for safe areas (notches, rounded corners) */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }
}

/* ========== LOGO STYLES ========== */
.logo {
    /* Set fixed dimensions for logo */
    width: 20px;
    height: 20px;
}

/* ========== MAIN LYRICS CONTAINER ========== */
#lyrics {
    /* Take up remaining vertical space */
    flex: 1;
    /* Center content vertically and horizontally */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    /* Responsive spacing between lyrics lines */
    gap: clamp(0.8rem, 3vh, 2rem);
    /* Responsive padding */
    padding: clamp(1rem, 3vw, 2rem);
    min-height: 100vh;
    width: 100%;
    /* Maximum width to maintain readability */
    max-width: 1200px;
    margin: 0 auto;
}

/* ========== LYRICS LINE STYLING ========== */
.lyric-line {
    text-align: center;
    /* Smooth transition for all animations */
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    padding: 0.2rem;
    max-width: 90%;
    /* Performance optimizations */
    will-change: opacity, transform;
    transform: translateZ(0);
    -webkit-font-smoothing: antialiased;
    position: relative;
    /* Subtle text glow effect - REVERTED to original elegant style */
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
}

/* ========== LYRICS STATES ========== */
/* Lines far from current (2+ lines away) */
.far-previous,
.far-next {
    opacity: 0.40;
    /* Responsive font size */
    font-size: clamp(0.8rem, 2vw, 1.4rem);
    transform: translateY(10px);
    filter: blur(1px);
}

/* Lines immediately before/after current */
.previous,
.next {
    opacity: 0.7; /* Increased from 0.6 for readability */
    font-size: clamp(1rem, 2.5vw, 1.8rem);
    transform: translateY(5px);
    
    /* STANDARD: No background pill by default */
    background: none;
    margin: 0 auto;
    width: fit-content;
    
    /* STANDARD: Clean, elegant text shadow */
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
}

/* Currently active line */
.current {
    font-size: clamp(1.5rem, 4vw, 3rem);
    opacity: 1;
    font-weight: 500;
    
    /* STANDARD: Stronger glow for active line */
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    
    transform: scale(1.02);
    letter-spacing: 0.5px;
    
    /* Apply floating animation */
    animation: wave 3s ease-in-out infinite;
    position: relative;
    z-index: 10;
    
    /* STANDARD: No background pill by default */
    background: none;
    width: fit-content;
    padding: 0;
    margin: 0 auto;
    box-shadow: none;
    border-radius: 0;
}

/* ========== ANIMATIONS ========== */
@keyframes wave {
    /* Gentle floating animation for current line + Scale */
    0% {
        transform: scale(1.02) translateY(0);
    }

    50% {
        transform: scale(1.02) translateY(-2px);
    }

    100% {
        transform: scale(1.02) translateY(0);
    }
}

/* ========== BOTTOM NAVIGATION ========== */
.bottom-nav {
    /* Stick to bottom of viewport */
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    /* Semi-transparent background with blur effect */
    background: rgba(26, 27, 38, 0.8);
    backdrop-filter: blur(10px);
    /* Responsive padding */
    padding: clamp(0.3rem, 2vh, 0.8rem);
    /* Layout controls */
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: auto;
    min-height: 40px;
    max-height: 60px;
    /* Subtle top border */
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    /* Ensure nav stays above other content */
    z-index: 1000;
}

/* ========== NAVIGATION ELEMENTS ========== */
.nav-controls {
    display: flex;
    align-items: center;
}

.nav {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin: 0;
    padding: 0;
    list-style: none;
}

.nav-link {
    /* Merged styles */
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    padding: 0.5rem 1rem; /* Kept the more generous padding */
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
}

.nav-link:hover,
.nav-link.active {
    color: white; /* Removed !important as specificity is now clean */
    background: rgba(255, 255, 255, 0.1);
}

.nav-link.exit-link {
    color: rgba(239, 68, 68, 0.8);
}

.nav-link.exit-link:hover {
    color: rgb(239, 68, 68);
    background: rgba(239, 68, 68, 0.1);
}

/* Update content padding to account for bottom nav */
#content {
    padding-bottom: 4rem;
}

/* Exit button styling */
.exit-btn {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    padding: 0.3rem 0.8rem;
    border-radius: 4px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

/* Red background on hover for exit button */
.exit-btn:hover {
    color: white;
    background: rgba(255, 0, 0, 0.2);
}

/* Credits section styling */
.credits {
    display: flex;
    align-items: center;
}

/* Repository link styling */
.repo-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.repo-link:hover {
    color: white;
}

/* ========== FORM ELEMENTS ========== */
input[type="range"] {
    width: 75%;
}

/* Cursor pointer for tooltip elements */
*[data-bs-toggle="tooltip"]:hover {
    cursor: pointer;
}

/* ========== RESPONSIVE DESIGN ========== */
/* Adjustments for small screens and embedded views */
@media (max-height: 600px),
(max-width: 600px) {
    #lyrics {
        min-height: 100vh;
        gap: 0.5rem;
        padding: 1rem;
    }
}

/* ========== HOME ASSISTANT MODE ========== */
/* Hide elements in minimal mode */
body[data-minimal="true"] .bottom-nav,
body[data-minimal="true"] #header,
body[data-minimal="true"] #footer {
    display: none !important;
}

/* Adjust lyrics container in minimal mode */
body[data-minimal="true"] #lyrics {
    min-height: 100vh;
    padding: 0;
}

/* ========== ACCESSIBILITY ========== */
/* Respect user's reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
    .lyric-line {
        transition: opacity 0.5s ease-out;
        animation: none !important;
    }
}

/* ========== UTILITY CLASSES ========== */
/* Helper classes for common styling needs */
.text-center {
    text-align: center;
}

.mt-auto {
    margin-top: auto;
}

.d-flex {
    display: flex;
}

.align-items-center {
    align-items: center;
}

/* ========== HOME ASSISTANT SPECIFIC STYLES ========== */

/* Minimal Mode overrides: Restore colored gradient background + Hidden UI */
body[data-minimal="true"] {
    /* Restore the default gradient background (same as normal mode) */
    background: linear-gradient(135deg, #1e2030 0%, #2f354d 100%);
}

body[data-minimal="true"] #lyrics {
    background: none;
    min-height: 100vh;
    padding: 0;
}

/* Hide elements in minimal mode */
body[data-minimal="true"] .bottom-nav,
body[data-minimal="true"] #header,
body[data-minimal="true"] #footer,
body[data-minimal="true"] .settings-toggle,
body[data-minimal="true"] .track-header,
body[data-minimal="true"] #player-ui-container,
body[data-minimal="true"] .album-art,
body[data-minimal="true"] .background-layer,
body[data-minimal="true"] .background-overlay {
    display: none !important;
}

/* ========== SETTINGS TOGGLE ========== */
.settings-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 200;
    width: 40px;
    height: 40px;
    border: none;
    background: transparent;
    color: white;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.settings-toggle:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: rotate(90deg);
}

/* ========== SETTINGS PANEL ========== */
.settings-panel {
    position: fixed;
    top: 80px;
    right: 1rem;
    background: rgba(26, 27, 38, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 12px;
    padding: 1.5rem;
    min-width: 300px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.settings-panel h3 {
    margin: 0 0 1rem 0;
    color: white;
    font-size: 1.2rem;
}

.settings-panel label {
    display: block;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0.8rem;
    cursor: pointer;
}

.settings-panel input[type="checkbox"] {
    margin-right: 0.5rem;
}

.settings-panel button {
    width: 100%;
    padding: 0.8rem;
    margin-top: 1rem;
    background: rgba(59, 130, 246, 0.3);
    border: 1px solid rgba(59, 130, 246, 0.5);
    color: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.settings-panel button:hover {
    background: rgba(59, 130, 246, 0.5);
}

.url-display {
    margin-top: 1rem;
    padding: 0.8rem;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
    word-break: break-all;
    max-height: 100px;
    overflow-y: auto;
}

/* ========== TRACK HEADER ========== */
.track-header {
    position: fixed;
    top: 1rem;
    left: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    z-index: 100;
    max-width: 400px;
}

/* Album Art Link Container */
#album-art-link {
    display: block;
    text-decoration: none;
    border-radius: 12px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* Hover effect for clickable album art */
#album-art-link[href^="spotify:"]:hover,
#album-art-link[href^="https://open.spotify.com"]:hover {
    transform: scale(1.05);
}

#album-art-link[href="#"] {
    cursor: default;
}

.album-art {
    width: clamp(90px, 12vw, 110px);
    height: clamp(90px, 12vw, 110px);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    /* Smooth fade transition for image changes (prevents flickering during DB population) */
    transition: opacity 0.3s ease, all 0.5s ease;
    object-fit: cover;
    /* Hide by default until valid src is loaded */
    opacity: 0;
    display: block;
}

/* Show album art only when it has a valid HTTP(S) URL or local path */
.album-art[src^="http"],
.album-art[src^="/"] {
    opacity: 1;
}

/* Fallback: hide empty src to prevent broken image icon */
.album-art:not([src]),
.album-art[src=""] {
    display: none !important;
}

.track-info {
    flex: 1;
    min-width: 0;
}

.track-title {
    font-size: clamp(1.1rem, 3vw, 1.3rem);
    font-weight: 600;
    color: white;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.track-artist {
    font-size: clamp(0.9rem, 2.5vw, 1rem);
    color: rgba(255, 255, 255, 0.75);
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    margin-top: 0.3rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ========== PLAYER UI CONTAINER ========== */
/* Groups progress bar and controls for dynamic positioning */
#player-ui-container {
    position: fixed;
    bottom: 80px;
    left: 0;
    right: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: bottom 0.3s ease;
    z-index: 900;
    pointer-events: none;
}

/* Move player container down when bottom nav is hidden */
body.hide-nav #player-ui-container {
    bottom: 20px;
}

/* ========== PROGRESS BAR ========== */
.progress-container {
    position: relative;
    width: clamp(300px, 60%, 500px);
    text-align: center;
    margin-bottom: 10px;
    pointer-events: auto;
    /* Add this to center it nicely if the parent is flex */
    margin-left: auto;
    margin-right: auto;

}

.progress-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.5rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.7) 0%,
        rgba(255, 255, 255, 0.95) 50%,
        rgba(255, 255, 255, 0.7) 100%
    );
    border-radius: 3px;
    transition: width 0.1s linear;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    position: relative;
}

/* Thumb indicator at end of progress bar */
.progress-fill::after {
    content: '';
    position: absolute;
    right: -4px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
}

.progress-time {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}

/* ========== PLAYBACK CONTROLS ========== */
.playback-controls {
    display: flex;
    justify-content: space-between; /* Spreads Left, Center, Right */
    align-items: center;
    gap: 10px;
    padding: 0.5rem 1.5rem; /* Increased side padding */
    background: rgba(26, 27, 38, 0.7); /* Slightly darker for better contrast */
    backdrop-filter: blur(15px);
    border-radius: 50px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    pointer-events: auto;
    width: clamp(300px, 90%, 500px); /* Fixed width constraint for centering */
    margin: 0 auto; /* Center the whole bar */
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.controls-left,
.controls-right {
    flex: 1;
    display: flex;
    align-items: center;
}

.controls-left {
    justify-content: flex-start;
}

.controls-right {
    justify-content: flex-end;
}

.controls-center {
    flex: 2;
    display: flex;
    justify-content: center;
    gap: 1.5rem; /* Space between Prev/Play/Next */
}

/* New Lyric Toggle Button (Bottom Left) */
.lyrics-toggle-btn {
    position: fixed;
    bottom: 24px;
    left: 24px;
    z-index: 150;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.lyrics-toggle-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: scale(1.05);
}

/* Hide in minimal mode */
body[data-minimal="true"] .lyrics-toggle-btn {
    display: none !important;
}

.control-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Force override Android default button styles */
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
}

.control-btn:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
}

.control-btn:active:not(:disabled) {
    transform: scale(0.95);
}

.control-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.play-pause-btn {
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
    background: transparent;
    position: relative;
    /* Override any emoji rendering */
    -webkit-tap-highlight-color: transparent;
    -webkit-text-fill-color: white;
}

/* Pure CSS Play Icon (triangle) */
.play-pause-btn.paused::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-40%, -50%);
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 8px 0 8px 14px;
    border-color: transparent transparent transparent white;
}

/* Pure CSS Pause Icon (two bars) */
.play-pause-btn.playing::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(calc(-50% - 5px), -50%);
    width: 4px;
    height: 16px;
    background: white;
    box-shadow: 6px 0 0 white;
}

/* ========== MINIMAL MODE OVERRIDES ========== */
body[data-minimal="true"] .settings-toggle,
body[data-minimal="true"] .track-header,
body[data-minimal="true"] #player-ui-container,
body[data-minimal="true"] .album-art {
    display: none !important;
}

/* ========== BOTTOM NAV TOGGLE ========== */
.bottom-nav.hidden {
    display: none !important;
}

/* ========== RESPONSIVE DESIGN FOR NEW COMPONENTS ========== */
@media (max-width: 768px) {
    .track-header {
        max-width: 250px;
    }

    .album-art {
        width: clamp(60px, 10vw, 100px);
        height: clamp(60px, 10vw, 100px);
    }

    .track-title {
        font-size: 1rem;
    }

    .track-artist {
        font-size: 0.85rem;
    }

    .control-btn {
        width: 38px;
        height: 38px;
        font-size: 0.95rem;
    }

    .play-pause-btn {
        width: 48px;
        height: 48px;
        font-size: 1.15rem;
    }

    /* Adjust container position for mobile */
    #player-ui-container {
        bottom: 90px;
    }

    body.hide-nav #player-ui-container {
        bottom: 10px;
    }
}

@media (max-width: 480px) {
    .track-header {
        top: 0.5rem;
        left: 0.5rem;
    }

    .settings-toggle {
        top: 0.5rem;
        right: 0.5rem;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
}

/* ========== SCROLLBAR STYLING ========== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* ========== BACKGROUND LAYERS ========== */
.background-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    filter: blur(var(--blur-strength, 20px));
    /* No scaling transform - matches Soft and Sharp modes */
    transform: none;
    -webkit-transform: none;
    display: none;
    /* Hidden by default */
    transition: background-image 0.5s ease-in-out;
    will-change: transform, opacity;
}

.background-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: rgba(0, 0, 0, var(--overlay-opacity, 0.6));
    display: none;
    /* Hidden by default */
    backdrop-filter: blur(30px) saturate(180%);
    /* Glassmorphism effect */
}

.background-layer.visible,
.background-overlay.visible {
    display: block;
}

/* ========== SHARP MODE (No Blur, High Res) ========== */
/* Sharp mode: Super sharp and clear album art with no blur effects */
/* Maximum sharpness - image rendered at native quality without any blur or scaling */
body.sharp-mode .background-layer {
    /* Micro-blur (0.5px) reduces jagged edges without looking blurry */
    filter: blur(0.5px) !important;

    /* Reset transforms to prevent scaling blur */
    transform: none !important;
    -webkit-transform: none !important;

    /* KEY: Forces browser to use best smoothing algorithm (bicubic/lanczos) */
    image-rendering: high-quality; 
    
    /* Performance hints for smooth transitions */
    will-change: opacity, background-image;
    
    /* Hardware acceleration */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

body.sharp-mode .background-overlay {
    /* Remove backdrop blur that causes haziness - this was the main culprit! */
    /* backdrop-filter: none !important; */
    /* -webkit-backdrop-filter: none !important; */
     /* FIX: Override the default flat black 0.6 opacity */
    /* Make it almost transparent to let the art shine */
 /*   background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.7) 100%) !important;*/
    backdrop-filter: blur(0.5px) saturate(105%) !important;
    -webkit-backdrop-filter: blur(0.5px) saturate(105%) !important;
    /* Very transparent background (5%) to let the art shine */
    background: rgba(0, 0, 0, 0.05) !important;

    /* OPTIONAL: If you want it even clearer, use 0.1 or 0.0 */
    /* background: rgba(0, 0, 0, 0.1) !important; */
    /* Vignette gradient: vibrant center, dark edges for text readability */
    /* Keeps the center of the 3000px art vibrant while darkening edges for text contrast */


   /* background: radial-gradient(circle at center, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0.75) 100%) !important;*/
}

/* ========== SHARP MODE SPECIFIC OVERRIDES ========== */
/* Since Sharp Mode has almost no global overlay (5%), we need stronger local contrast for text */

body.sharp-mode .current {
    /* RADIAL GRADIENT FADE - Darkest in the very center behind text */
    background: radial-gradient(
        closest-side,
        rgba(0, 0, 0, 0.0) 0%,    /* Very subtle core */
        rgba(0, 0, 0, 0.0) 80%,   /* Extends far out before fading */
        transparent 100%
    ) !important;
    
    /* Blends the dark pill with the album art color */
    mix-blend-mode: luminosity; 
    
    /* Tighter padding = smaller shadow footprint */
    padding: 10px 32px; 
    width: fit-content;
    max-width: 90%;
    margin: 0 auto;
    
    /* Explicitly reset global box/border styles */
    box-shadow: none;
    border-radius: 0; 

    /* HYBRID SHADOW: Crisp Black Definition + Ethereal White Halo */
    text-shadow: 
        /* CHANGE 1: Increase opacity (last number) from 0.5 to 0.8 or 1.0 for darker outline */
        /* You can also increase the blur (3rd number) from 4px to 8px for a wider shadow */
        0 2px 4px rgba(0, 0, 0, 0.9),   

        /* CHANGE 2: Increase white glow opacity from 0.3 to 0.5 for more pop against dark backgrounds */
        0 0 20px rgba(255, 255, 255, 0.5) !important; 
    
    /* Smooth transition for the pill effect */
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s ease;
}

/* Also slightly darken the adjacent lines in Sharp Mode */
body.sharp-mode .previous,
body.sharp-mode .next {
    /* SUBTLE PILL BACKGROUND for readability on light art */
    background: radial-gradient(
        closest-side,
        rgba(0, 0, 0, 0.0) 0%,
        rgba(0, 0, 0, 0.0) 75%,
        transparent 100%
    ) !important;
    
    /* Inherit blend mode behavior */
    mix-blend-mode: luminosity;
    
    padding: 4px 20px;
    width: fit-content;
    margin: 0 auto;
    
    /* HYBRID SHADOW: Definition + Soft Glow */
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.8), /* Increased from 0.5 to match your strong style */
        0 0 10px rgba(255, 255, 255, 0.2) !important; /* Slight bump for visibility */
        
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}


/* ========== SOFT MODE (Medium Blur, No Scaling) ========== */
/* Soft mode: Medium blur album art background - balanced between sharp and blurred */
/* Provides good image clarity with better text readability than sharp mode */
body.soft-mode .background-layer {
    /* Medium blur (6px) - provides softness while maintaining image clarity */
    filter: blur(3px) !important;
    /* Remove scaling transform to show image at native size (no upscaling artifacts) */
    transform: none !important;
    -webkit-transform: none !important;
    /* Use high-quality rendering for photos */
    image-rendering: auto;
}

body.soft-mode .background-overlay {
    /* Light backdrop blur (10px) - softens edges without major haziness */
    backdrop-filter: blur(5px) saturate(140%) !important;
    -webkit-backdrop-filter: blur(5px) saturate(140%) !important;
    /* Medium dark overlay for better text contrast and readability */
    background: rgba(0, 0, 0, 0.20) !important;
}

/* ========== SPOTIFY LOGIN OVERLAY ========== */
.spotify-login-overlay {
    /* Full screen overlay */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    /* Dark semi-transparent background */
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
    /* Center the login card */
    display: flex;
    justify-content: center;
    align-items: center;
    /* Smooth fade-in animation */
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

.spotify-login-card {
    /* Card container */
    background: linear-gradient(135deg, #1e2030 0%, #2f354d 100%);
    border-radius: 16px;
    padding: 40px;
    max-width: 400px;
    width: 90%;
    /* Center content */
    text-align: center;
    /* Subtle shadow for depth */
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    /* Border for definition */
    border: 1px solid rgba(255, 255, 255, 0.1);
    /* Smooth scale-in animation */
    animation: scaleIn 0.3s ease-out;
}

@keyframes scaleIn {
    from {
        transform: scale(0.9);
        opacity: 0;
    }

    to {
        transform: scale(1);
        opacity: 1;
    }
}

.spotify-login-icon {
    /* Large emoji icon */
    font-size: 64px;
    margin-bottom: 20px;
    /* Subtle animation */
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {

    0%,
    100% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.05);
    }
}

.spotify-login-card h2 {
    /* Heading style */
    color: #ffffff;
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 12px;
}

.spotify-login-card p {
    /* Description text */
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    margin-bottom: 24px;
    line-height: 1.5;
}

.spotify-login-button {
    /* Spotify green button */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: #1DB954;
    /* Spotify brand green */
    color: #ffffff;
    padding: 14px 28px;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.3s ease;
    /* Hover effect */
    box-shadow: 0 4px 12px rgba(29, 185, 84, 0.3);
}

.spotify-login-button:hover {
    /* Hover state */
    background: #1ed760;
    /* Lighter green on hover */
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(29, 185, 84, 0.4);
    color: #ffffff;
    text-decoration: none;
}

.spotify-login-button:active {
    /* Active/pressed state */
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(29, 185, 84, 0.3);
}

.spotify-login-note {
    /* Small note text */
    color: rgba(255, 255, 255, 0.6);
    font-size: 12px;
    margin-top: 16px;
    margin-bottom: 0;
}

/* ========== VISUAL MODE STYLES ========== */

/* Visual Mode - Hide Lyrics Container */
.lyrics-container {
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    opacity: 1;
    transform: translateY(0);
}

.lyrics-container.visual-mode-hidden {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
}

/* Slideshow Base */
.slideshow-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    opacity: 0;
    transition: opacity 2s ease-in-out;
    z-index: 0;
}

.slideshow-image.active {
    opacity: 1;
}

/* Ken Burns Effect - Pan and Zoom */
.ken-burns-effect {
    animation: kenBurns 8s ease-out forwards;
}

@keyframes kenBurns {
    0% {
        transform: scale(1) translate(0, 0);
    }
    100% {
        transform: scale(1.1) translate(-2%, -2%);
    }
}

/* Alternate Ken Burns animations for variety */
.ken-burns-effect:nth-child(even) {
    animation: kenBurnsAlt 8s ease-out forwards;
}

@keyframes kenBurnsAlt {
    0% {
        transform: scale(1.05) translate(-1%, 0);
    }
    100% {
        transform: scale(1.15) translate(1%, -3%);
    }
}

/* Ensure background layer can contain slideshow images */
.background-layer {
    position: fixed; /* Changed back to fixed */
    overflow: hidden;
}

/* Like Button Active State */
#btn-like.liked {
    color: #1DB954; /* Spotify Green */
    text-shadow: 0 0 10px rgba(29, 185, 84, 0.4);
}

/* Queue Drawer */
.queue-drawer {
    position: fixed;
    top: 0;
    right: -300px; /* Hidden by default */
    width: 300px; /* Slightly wider */
    max-width: 85vw; /* Responsive on mobile */
    height: 100vh;
    height: 100dvh;
    
    /* Transparent background as requested, slight blur for readability */
    /* background: rgba(0, 0, 0, 0.3); 
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    
    border-left: 1px solid rgba(255, 255, 255, 0.1); */

    z-index: 2000;
    transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  /*  box-shadow: -10px 0 40px rgba(0,0,0,0.6); */
    display: flex;
    flex-direction: column;
    padding: 20px;
    /* FIX: Ensure interactions work inside */
    pointer-events: auto; 
}

/* Queue Backdrop - Disable strictly for the lyrics area interaction */
.queue-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Totally transparent so it doesn't darken the lyrics */
    background: transparent; 
    z-index: 1999; /* Below drawer, above content */
    opacity: 0;
    pointer-events: none; /* Default to pass-through */
    transition: none; /* Instant toggle */
}

.queue-backdrop.visible {
    /* Still transparent, but blocks clicks to content */
    opacity: 1; 
    pointer-events: auto; /* Catch clicks */
}

/* Ensure scrolling works */
.queue-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 5px;
    -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
    pointer-events: auto; /* Explicitly enable pointer events */

    /* Hide Scrollbar - Chrome, Safari, Opera */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
    
}

.queue-list::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
    width: 0;
    height: 0;
    background: transparent;
}

/* RESTORED: Missing Queue Styles */
.queue-drawer.open {
    right: 0;
}

/* Queue Header Controls */
.queue-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.queue-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: white;
}

#queue-close {
  /*  background: none;
    border: none;
    color: rgba(255,255,255,0.6);
    font-size: 1.5rem;
    cursor: pointer;
    /* Hide the X button as requested */
    display: none;

}

/* Queue Backdrop for clicking outside */
.queue-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
   /* background: rgba(0,0,0,0.5); */
    z-index: 1999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.queue-backdrop.visible {
    opacity: 1;
    pointer-events: auto;
}

.queue-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 5px;
    -webkit-overflow-scrolling: touch;
    /* FIX: Ensure scrollable area is clickable */
    pointer-events: auto;
}

.queue-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 8px;
    transition: background 0.2s;
}

.queue-item:hover {
    background: rgba(255,255,255,0.05);
}

.queue-art {
    width: 40px;
    height: 40px;
    border-radius: 4px;
    object-fit: cover;
}

.queue-info {
    flex: 1;
    min-width: 0;
}

.queue-title {
    font-size: 0.9rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 2px;
}

.queue-artist {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.6);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Background Style Controls in Modal */
.style-controls-section {
    /* Remove padding and background for cleaner look */
    padding: 0;
    background: transparent;
    border-radius: 0;
    margin-bottom: 16px;
    text-align: left; /* Align with content */
    display: flex;
    align-items: center;
    justify-content: space-between; /* Spread title and buttons */
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 12px;
}

.style-controls-section h4 {
    margin: 0;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.9);
    font-weight: 600;
    /* Renamed "Background Style" to simpler "Style" in your head if desired, or keep as is */
}

.style-buttons {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-bottom: 0; /* Remove margin */
}

.style-btn {
    padding: 4px 12px; /* Smaller padding */
    font-size: 0.75rem; /* Smaller text */
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 6px; /* Less rounded, more sleek */
    cursor: pointer;
    transition: all 0.2s;
    color: rgba(255,255,255,0.7);
}

.style-btn:hover {
    background: rgba(255,255,255,0.1);
    color: white;
}

.style-btn.active {
    background: #3b82f6;
    border-color: #3b82f6;
    color: white;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

/* Hide the hint text */
.style-hint {
    display: none;
}

/* FIX: Grid Overlapping */
.art-grid {
    display: grid;
    /* Use auto-fill with a fixed minimum to ensure consistent rows */
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 16px;
    margin-top: 16px;
    /* Ensure the grid respects the container width */
    width: 100%; 
    /* Ensure content flows naturally */
    grid-auto-rows: min-content; /* Changed from max-content to min-content to fit content exactly */
    align-items: start; /* Align items to top of their cells */
}

/* Header for Artist Images Section */
.artist-images-header {
    grid-column: 1 / -1; /* Span full width */
    width: 100%;
    margin-top: 24px;
    margin-bottom: 12px;
    padding-top: 24px;
    border-top: 1px solid rgba(255,255,255,0.1);
    color: rgba(255,255,255,0.8);
    font-size: 0.9rem;
    font-weight: 600;
    /* Ensure it breaks the grid flow visually */
    display: flex;
    align-items: center;
    /* Force it to start on a new row */
    grid-row-start: auto;

}

